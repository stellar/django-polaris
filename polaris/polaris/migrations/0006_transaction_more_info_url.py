# Generated by Django 2.2.18 on 2021-02-26 23:53

from django.db import migrations, models
from django.urls import reverse
from polaris import settings


def populate_more_info_urls(apps, _):
    Transaction = apps.get_model("polaris", "Transaction")
    for transaction in Transaction.objects.filter(protocol__in=["sep6", "sep24"]):
        path = reverse(
            "more_info" if transaction.protocol == "sep24" else "more_info_sep6"
        )
        transaction.more_info_url = f"{settings.HOST_URL}{path}?id={transaction.id}"
        transaction.save()


def noop(*_):
    # the DB column can be dropped without any reversal logic
    pass


class Migration(migrations.Migration):

    dependencies = [
        ("polaris", "0005_auto_20210226_0053"),
    ]

    operations = [
        migrations.AddField(
            model_name="transaction",
            name="more_info_url",
            field=models.TextField(blank=True, null=True),
        ),
        migrations.RunPython(populate_more_info_urls, noop),
    ]
